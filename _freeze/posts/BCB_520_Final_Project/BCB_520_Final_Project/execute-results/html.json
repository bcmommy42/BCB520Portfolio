{
  "hash": "aaa35cee96379732db62b278449744c0",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"BCB 520 Final Project\"\nsubtitle: \"The Impact of Staph. aureus Mastitis on Udder Tissue and Secretions in Heifers During Induced Lactogenesis\"\nauthor: \"Betsy Church\"\ndate: \"4/3/2025\"\nformat: html\ncategories: [Assignment, DataViz]\ncode-fold: true\ncode-tools: true\n---\n\n\n\n# Preamble\n\nOne of the largest sources of loss in the dairy industry is mastitis. Mastitis, an infection of the mammary tissue, is common before or during first lactation in heifers. Infections during initial lactogenesis can cause issues with low milk supply throughout the first and subsequent lactations in cows. Here, we are trying to determine if there is a change in the udder microbiome by exposing one quarter of the udder to S.aureus via infusion while exposing another different quarter to an infusion of saline. Secretions from the udders were collected over the course of 20 days. On the final day of the study, the heifers were sacrificed and tissue from the 2 quarters were collected. In each quarter, a portion of the tissue close to the gland cistern (center) was collected along with a portion of tissue closer to the fat pad (edge).\n\nUsing the collected secretions and tissue samples, we will attempt to discover: 1. Is there a microbiome detectable in mammary tissue? 2. Is there a tissue microbiome difference within the same cow between infected/uninfected quarters? 3. Is there a tissue microbiome difference within the same cow between the edge versus center tissue of the infected/uninfected tissue? 4. How does an IMI with S. aureus affect the microbiome of milk secretions? Is there a change over time? 5. How does the microbiome of the tissue samples compare to the microbiome of the secretion samples? \\# Data\n\n**Since this research is still in the data collection phase, I chose to use mock data that Anything LLM came up with for me.**\n\nThis data set was not conducive to spatial or networking data. For this, I will be using breastfeeding rates by state, found at https://www.cdc.gov/breastfeeding-data/breastfeeding-report-card/index.html\n\n# Visualizations\n\n## Bar chart comparing Tissue Locations to Relative Abundance\n\nI asked Anything LLM to make me a mock relative abundance data set for tissue from the same animal but for 2 separate locations within the quarters.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nuse_this_mock <-read.csv(\"C:/Users/betsy/OneDrive/use_this_mock.csv\")\ndata <- data.frame(use_this_mock,\n  Location = c('Edge', 'Center'),\n  Infection_Status= c('Infection.Status'),\n  Bacteria = c('Staph.aureus', 'E..coli', 'Lactobacillus','Bacillus','Other')\n)\n\nlong_data <- data %>%\n  pivot_longer(\n    cols = c(Staph.aureus, E..coli, Lactobacillus, Bacillus, Other),\n    names_to = \"Bacterial_Species\",\n    values_to = \"Abundance\"\n  )\n\n# Create the bar graph\nggplot(long_data, aes(x = Bacteria, y = Abundance, fill = Location)) +\n  geom_bar(stat = \"identity\", position = \"dodge\") +\n  labs(title = \"Relative Abundance of Bacteria by Tissue Location\",\n       x = \"Bacterial Species\",\n       y = \"Relative Abundance (%)\") +\n  theme_minimal() +\n  scale_fill_manual(values = c(\"Edge\" = \"skyblue\", \"Center\" = \"orange\"))\n```\n\n::: {.cell-output-display}\n![](BCB_520_Final_Project_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n:::\n\n\n\n## Mean Relative Abundance between Infected and Uninfected Tissue Samples\n\nI wanted to compare the mean Relative Abundance across 80 animals, comparing the uninfected quarter to the infected quarter tissue samples.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(123)  # For reproducibility\n\n# Parameters\nn_animals <- 80\nbacteria_genera <- c(\"Staph_aureus\", \"E_coli\", \"Lactobacillus\", \"Bacillus\", \"Clostridium\", \"Streptococcus\", \"Salmonella\", \"Other\")\n\n# Function to generate random microbiome data with infection consideration\ngenerate_abundance <- function(infected = FALSE) {\n  abundance <- runif(length(bacteria_genera), min = 0, max = 100)\n  if (infected) {\n    abundance[1] <- abundance[1] + 50  # Increase Staph_aureus abundance for infected samples\n  }\n  return(round(100 * abundance / sum(abundance), 2))  # Normalize to sum to 100%\n}\n\n# Create the dataset\ndata <- data.frame()\n\nfor (i in 1:n_animals) {\n  for (location in c(\"Edge\", \"Center\")) {\n    # Infected quarter samples\n    infected_abundance <- generate_abundance(infected = TRUE)\n    infected_data <- data.frame(\n      AnimalID = paste0(\"Cow_\", sprintf(\"%02d\", i)),\n      QuarterStatus = \"Infected\",\n      Location = location,\n      t(infected_abundance)\n    )\n    \n    # Uninfected quarter samples\n    uninfected_abundance <- generate_abundance(infected = FALSE)\n    uninfected_data <- data.frame(\n      AnimalID = paste0(\"Cow_\", sprintf(\"%02d\", i)),\n      QuarterStatus = \"Uninfected\",\n      Location = location,\n      t(uninfected_abundance)\n    )\n    \n    # Set column names\n    colnames(infected_data)[4:ncol(infected_data)] <- bacteria_genera\n    colnames(uninfected_data)[4:ncol(uninfected_data)] <- bacteria_genera\n    \n    # Add to the dataset\n    data <- rbind(data, infected_data, uninfected_data)\n  }\n}\n\n# Summarize data for bar chart\nsummary_data <- data %>%\n  pivot_longer(cols = Staph_aureus:Other, names_to = \"Bacteria\", values_to = \"Abundance\") %>%\n  group_by(QuarterStatus, Bacteria) %>%\n  summarize(Mean_Abundance = mean(Abundance))\n\n# Create the bar chart\nggplot(summary_data, aes(x = Bacteria, y = Mean_Abundance, fill = QuarterStatus)) +\n  geom_bar(stat = \"identity\", position = \"dodge\") +\n  labs(title = \"Mean Bacterial Abundance in Infected vs. Uninfected Tissue Samples\",\n       x = \"Bacterial Genera\",\n       y = \"Mean Abundance (%)\") +\n  theme_minimal() +\n  scale_fill_manual(values = c(\"Infected\" = \"red\", \"Uninfected\" = \"blue\")) +\n  theme(axis.text.x = element_text(angle = 45, hjust = 1))\n```\n\n::: {.cell-output-display}\n![](BCB_520_Final_Project_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n\n## Principal Coordinate Analysis Plot Looking at Microbiome of Tissue Location and Infection Status\n\nPCoA plots can be helpful because it can give a visualization of how dissimilar data is. In this instance, I was wanting to see if there would be distinct clustering of microbiome data by tissue location or infection status. Before being able to use the PCoA plot, I first had to compute the Bray-Curtis distance Matrix. This allowed me to quantify how dissimilar the relative abudances were between the samples.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Set a CRAN mirror\noptions(repos = c(CRAN = \"https://cloud.r-project.org\"))\n\n# Now install packages\ninstall.packages(\"vegan\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\npackage 'vegan' successfully unpacked and MD5 sums checked\n\nThe downloaded binary packages are in\n\tC:\\Users\\betsy\\AppData\\Local\\Temp\\Rtmp0yeMV8\\downloaded_packages\n```\n\n\n:::\n\n```{.r .cell-code}\nset.seed(123)  # For reproducibility\n\n# Parameters\nn_animals <- 80\nbacteria_genera <- c(\"Staph_aureus\", \"E_coli\", \"Lactobacillus\", \"Bacillus\", \"Clostridium\", \"Streptococcus\", \"Salmonella\", \"Other\")\n\n# Function to generate random microbiome data with infection consideration\ngenerate_abundance <- function(infected = FALSE) {\n  abundance <- runif(length(bacteria_genera), min = 0, max = 100)\n  if (infected) {\n    abundance[1] <- abundance[1] + 50  # Increase Staph_aureus abundance for infected samples\n  }\n  return(round(100 * abundance / sum(abundance), 2))  # Normalize to sum to 100%\n}\n\n# Create the dataset\ndata <- data.frame()\n\nfor (i in 1:n_animals) {\n  for (location in c(\"Edge\", \"Center\")) {\n    # Create a vector for infected and uninfected samples\n    infected_abundance <- generate_abundance(infected = TRUE)\n    uninfected_abundance <- generate_abundance(infected = FALSE)\n\n    # Infected quarter samples\n    infected_data <- data.frame(\n      AnimalID = paste0(\"Cow_\", sprintf(\"%02d\", i)),\n      QuarterStatus = \"Infected\",\n      Location = location,\n      Staph_aureus = infected_abundance[1],\n      E_coli = infected_abundance[2],\n      Lactobacillus = infected_abundance[3],\n      Bacillus = infected_abundance[4],\n      Clostridium = infected_abundance[5],\n      Streptococcus = infected_abundance[6],\n      Salmonella = infected_abundance[7],\n      Other = infected_abundance[8]\n    )\n\n    # Uninfected quarter samples\n    uninfected_data <- data.frame(\n      AnimalID = paste0(\"Cow_\", sprintf(\"%02d\", i)),\n      QuarterStatus = \"Uninfected\",\n      Location = location,\n      Staph_aureus = uninfected_abundance[1],\n      E_coli = uninfected_abundance[2],\n      Lactobacillus = uninfected_abundance[3],\n      Bacillus = uninfected_abundance[4],\n      Clostridium = uninfected_abundance[5],\n      Streptococcus = uninfected_abundance[6],\n      Salmonella = uninfected_abundance[7],\n      Other = uninfected_abundance[8]\n    )\n\n    # Add to the dataset\n    data <- rbind(data, infected_data, uninfected_data)\n  }\n}\n\n# Print the first few rows of the dataset\nhead(data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  AnimalID QuarterStatus Location Staph_aureus E_coli Lactobacillus Bacillus\n1   Cow_01      Infected     Edge        14.93  14.95          7.75    16.74\n2   Cow_01    Uninfected     Edge        11.81   9.78         20.48     9.70\n3   Cow_01      Infected   Center        14.11   0.80          6.20    18.05\n4   Cow_01    Uninfected   Center        13.65  14.75         11.33    12.37\n5   Cow_02      Infected     Edge        29.67  19.82          0.61    11.91\n6   Cow_02    Uninfected     Edge         6.13  17.79         17.76    15.83\n  Clostridium Streptococcus Salmonella Other\n1       17.83          0.86      10.01 16.92\n2       14.51         12.26       2.20 19.26\n3       16.82         13.10      12.11 18.80\n4        6.02          3.06      20.05 18.78\n5       18.90          5.39       7.93  5.77\n6        6.54          5.96      10.00 20.00\n```\n\n\n:::\n\n```{.r .cell-code}\n# Load necessary libraries\ninstall.packages(\"vegan\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\npackage 'vegan' successfully unpacked and MD5 sums checked\n\nThe downloaded binary packages are in\n\tC:\\Users\\betsy\\AppData\\Local\\Temp\\Rtmp0yeMV8\\downloaded_packages\n```\n\n\n:::\n\n```{.r .cell-code}\ninstall.packages(\"ggplot2\")\nlibrary(vegan)\nlibrary(ggplot2)\nlibrary(dplyr)\n\n# Generate the data (based on the previous example)\nset.seed(123)  # For reproducibility\n\n# Parameters\nn_animals <- 80\nbacteria_genera <- c(\"Staph_aureus\", \"E_coli\", \"Lactobacillus\", \"Bacillus\", \"Clostridium\", \"Streptococcus\", \"Salmonella\", \"Other\")\n\n# Function to generate random microbiome data with infection consideration\ngenerate_abundance <- function(infected = FALSE) {\n  abundance <- runif(length(bacteria_genera), min = 0, max = 100)\n  if (infected) {\n    abundance[1] <- abundance[1] + 50  # Increase Staph_aureus abundance for infected samples\n  }\n  return(round(100 * abundance / sum(abundance), 2))  # Normalize to sum to 100%\n}\n\n# Create the dataset\ndata <- data.frame()\n\nfor (i in 1:n_animals) {\n  for (location in c(\"Edge\", \"Center\")) {\n    # Infected quarter samples\n    infected_data <- data.frame(\n      AnimalID = paste0(\"Cow_\", sprintf(\"%02d\", i)),\n      QuarterStatus = \"Infected\",\n      Location = location,\n      t(generate_abundance(infected = TRUE))\n    )\n\n    # Uninfected quarter samples\n    uninfected_data <- data.frame(\n      AnimalID = paste0(\"Cow_\", sprintf(\"%02d\", i)),\n      QuarterStatus = \"Uninfected\",\n      Location = location,\n      t(generate_abundance(infected = FALSE))\n    )\n\n    # Set column names\n    colnames(infected_data)[4:ncol(infected_data)] <- bacteria_genera\n    colnames(uninfected_data)[4:ncol(uninfected_data)] <- bacteria_genera\n\n    # Add to the dataset\n    data <- rbind(data, infected_data, uninfected_data)\n  }\n}\n\n# Prepare the data for PCoA\ncombined_data <- data %>%\n  mutate(SampleType = paste(QuarterStatus, Location, sep = \"_\")) %>%\n  select(-AnimalID, -QuarterStatus, -Location)\n\n# Compute Bray-Curtis distance matrix\ndistance_matrix <- vegdist(combined_data[, -ncol(combined_data)], method = \"bray\")\n\n# Perform PCoA\npcoa_result <- cmdscale(distance_matrix, eig = TRUE, k = 2)\n\n# Create a data frame with the PCoA results\npcoa_df <- as.data.frame(pcoa_result$points)\ncolnames(pcoa_df) <- c('PC1', 'PC2')\npcoa_df$SampleType <- combined_data$SampleType\n\n# Plot the PCoA\nggplot(pcoa_df, aes(x = PC1, y = PC2, color = SampleType)) +\n  geom_point(size = 3) +\n  labs(title = \"PCoA of Microbiome Data: Edge vs Center and Infected vs Uninfected\",\n       x = \"Principal Coordinate 1\",\n       y = \"Principal Coordinate 2\") +\n  theme_minimal() +\n  scale_color_manual(values = c(\n    \"Infected_Edge\" = \"red\", \n    \"Infected_Center\" = \"darkred\", \n    \"Uninfected_Edge\" = \"blue\", \n    \"Uninfected_Center\" = \"darkblue\"\n  ))\n```\n\n::: {.cell-output-display}\n![](BCB_520_Final_Project_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n\n## Heat Map of Secretion Data\n\nI wanted to look at several things at once, including relative abundance differences between the days secretions were collected, between infection status, and between the different animals. This heat map allowed me to look at all of the above in an easy and concise manner. I also was able to create a heatmap showing just the average overall relative abundance and used that to compare the infected versus the uninfected samples across the 20 days of collection.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmock_quarters_daily <-read.csv(\"C:/Users/betsy/OneDrive/mock_quarters_daily.csv\")\n\n# Convert data to long format\nlong_data2 <- mock_quarters_daily %>%\n  pivot_longer(cols = Staph.aureus:Other, \n               names_to = \"Bacteria\", \n               values_to = \"Abundance\")\n\n# Create the heat map\nggplot(long_data2, aes(x = Day, y = Bacteria, fill = Abundance)) +\n  geom_tile() +\n  facet_grid(Quarter ~ Animal.ID) +\n  scale_fill_gradient(low = \"white\", high = \"red\") +\n  labs(title = \"Heat Map of Relative Abundance: Secretions by Day, Quarter, and Animal\",\n       x = \"Day\",\n       y = \"Bacterial Species\",\n       fill = \"Abundance\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](BCB_520_Final_Project_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n\n```{.r .cell-code}\nread.csv(\"C:/Users/betsy/OneDrive/mock_quarters_daily.csv\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   Sample.ID Animal.ID Day    Quarter Staph.aureus E..coli Lactobacillus\n1       S001       A01   1   Infected           55      10             5\n2       S002       A01   1 Uninfected            5      20            40\n3       S003       A02   1   Infected           53      12             6\n4       S004       A02   1 Uninfected            6      18            41\n5       S005       A03   1   Infected           54      11             5\n6       S006       A03   1 Uninfected            4      19            41\n7       S007       A01   4   Infected           56       9             5\n8       S008       A01   4 Uninfected            5      21            39\n9       S009       A02   4   Infected           54      10             6\n10      S010       A02   4 Uninfected            6      19            40\n11      S011       A03   4   Infected           53      12             5\n12      S012       A03   4 Uninfected            4      18            42\n13      S013       A01   8   Infected           57       9             5\n14      S014       A01   8 Uninfected            5      20            40\n15      S015       A02   8   Infected           55      10             6\n16      S016       A02   8 Uninfected            6      17            42\n17      S017       A03   8   Infected           54      11             5\n18      S018       A03   8 Uninfected            4      18            41\n19      S019       A01  10   Infected           56       9             5\n20      S020       A01  10 Uninfected            5      19            41\n21      S021       A02  10   Infected           53      12             5\n22      S022       A02  10 Uninfected            6      20            39\n23      S023       A03  10   Infected           55      10             6\n24      S024       A03  10 Uninfected            4      19            41\n25      S025       A01  14   Infected           57       9             5\n26      S026       A01  14 Uninfected            5      21            39\n27      S027       A02  14   Infected           54      10             6\n28      S028       A02  14 Uninfected            6      18            41\n29      S029       A03  14   Infected           55      11             5\n30      S030       A03  14 Uninfected            4      20            40\n31      S031       A01  20   Infected           56       9             5\n32      S032       A01  20 Uninfected            5      19            41\n33      S033       A02  20   Infected           54      10             6\n34      S034       A02  20 Uninfected            6      18            42\n35      S035       A03  20   Infected           55      11             5\n36      S036       A03  20 Uninfected            4      19            41\n37      S109       A18  14   Infected           57       9             5\n38      S110       A18  14 Uninfected            5      21            39\n   Bacillus Other\n1         5    25\n2        10    25\n3         4    25\n4        10    25\n5         5    25\n6        11    25\n7         6    24\n8        11    24\n9         5    25\n10       10    25\n11        5    25\n12       11    25\n13        5    24\n14       11    24\n15        5    24\n16       11    24\n17        6    24\n18       12    25\n19        5    25\n20       10    25\n21        5    25\n22       10    25\n23        5    24\n24       11    25\n25        5    24\n26       11    24\n27        5    25\n28       10    25\n29        5    24\n30       11    25\n31        6    24\n32       11    24\n33        5    25\n34        9    25\n35        5    24\n36       12    24\n37        5    24\n38       10    25\n```\n\n\n:::\n\n```{.r .cell-code}\nlong_data1 <- mock_quarters_daily %>%\n  pivot_longer(cols = Staph.aureus:Other, \n               names_to = \"Bacteria\", \n               values_to = \"Abundance\")\n\n# Create the heat map\nggplot(long_data1, aes(x = Day, y = Bacteria, fill = Abundance)) +\n  geom_tile() +\n  facet_wrap(~ Quarter) +\n  scale_fill_gradient(low = \"white\", high = \"red\") +\n  labs(title = \"Heat Map of Relative Abundance in Secretion by Day and Quarter\",\n       x = \"Day\",\n       y = \"Bacterial Species\",\n       fill = \"Abundance\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](BCB_520_Final_Project_files/figure-html/unnamed-chunk-4-2.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load necessary libraries\ninstall.packages(\"ggplot2\")\nlibrary(ggplot2)\nlibrary(dplyr)\nlibrary(tidyr)\n\n# Generate the mock microbiome data (based on the previous example)\nset.seed(123)  # For reproducibility\n\n# Parameters\nn_animals <- 80\nbacteria_genera <- c(\"Staph_aureus\", \"E_coli\", \"Lactobacillus\", \"Bacillus\", \"Clostridium\", \"Streptococcus\", \"Salmonella\", \"Other\")\n\n# Function to generate random microbiome data with infection consideration\ngenerate_abundance <- function(infected = FALSE) {\n  abundance <- runif(length(bacteria_genera), min = 0, max = 100)\n  if (infected) {\n    abundance[1] <- abundance[1] + 50  # Increase Staph_aureus abundance for infected samples\n  }\n  return(round(100 * abundance / sum(abundance), 2))  # Normalize to sum to 100%\n}\n\n# Create the dataset\ndata <- data.frame()\n\nfor (i in 1:n_animals) {\n  for (sample_type in c(\"Tissue\", \"Secretion\")) {\n    # Infected samples\n    infected_abundance <- generate_abundance(infected = TRUE)\n    infected_data <- data.frame(\n      AnimalID = paste0(\"Cow_\", sprintf(\"%02d\", i)),\n      Status = \"Infected\",\n      SampleType = sample_type,\n      t(infected_abundance)\n    )\n    \n    # Uninfected samples\n    uninfected_abundance <- generate_abundance(infected = FALSE)\n    uninfected_data <- data.frame(\n      AnimalID = paste0(\"Cow_\", sprintf(\"%02d\", i)),\n      Status = \"Uninfected\",\n      SampleType = sample_type,\n      t(uninfected_abundance)\n    )\n    \n    # Set column names\n    colnames(infected_data)[4:ncol(infected_data)] <- bacteria_genera\n    colnames(uninfected_data)[4:ncol(uninfected_data)] <- bacteria_genera\n    \n    # Add to the dataset\n    data <- rbind(data, infected_data, uninfected_data)\n  }\n}\n\n# Summarize data for bar chart\nsummary_data <- data %>%\n  pivot_longer(cols = Staph_aureus:Other, names_to = \"Bacteria\", values_to = \"Abundance\") %>%\n  group_by(Status, SampleType, Bacteria) %>%\n  summarize(Mean_Abundance = mean(Abundance), .groups = 'drop')\n\n# Create the bar chart\nggplot(summary_data, aes(x = Bacteria, y = Mean_Abundance, fill = interaction(Status, SampleType))) +\n  geom_bar(stat = \"identity\", position = \"dodge\") +\n  labs(title = \"Mean Bacterial Abundance: Infected vs. Uninfected Tissue and Secretion\",\n       x = \"Bacterial Genera\",\n       y = \"Mean Abundance (%)\") +\n  theme_minimal() +\n  scale_fill_manual(values = c(\"Infected.Tissue\" = \"red\", \"Infected.Secretion\" = \"darkred\", \n                               \"Uninfected.Tissue\" = \"blue\", \"Uninfected.Secretion\" = \"darkblue\")) +\n  theme(axis.text.x = element_text(angle = 45, hjust = 1))\n```\n\n::: {.cell-output-display}\n![](BCB_520_Final_Project_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n\n## Principal Coordinate Analysis Plot for Tissue Versus Secretions\n\nOnce again, I was wanting to see if there would be distinct clustering of microbiome data, but this time by tissue or secretion.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(123)  # For reproducibility\n\n# Parameters\nn_animals <- 80\nbacteria_genera <- c(\"Staph_aureus\", \"E_coli\", \"Lactobacillus\", \"Bacillus\", \"Clostridium\", \"Streptococcus\", \"Salmonella\", \"Other\")\n\n# Function to generate random microbiome data\ngenerate_abundance <- function() {\n  abundance <- runif(length(bacteria_genera), min = 0, max = 100)\n  return(round(100 * abundance / sum(abundance), 2))  # Normalize to sum to 100%\n}\n\n# Create the dataset\ndata <- data.frame()\n\nfor (i in 1:n_animals) {\n  for (condition in c(\"Infected_Tissue\", \"Uninfected_Tissue\", \"Infected_Secretion\", \"Uninfected_Secretion\")) {\n    sample_data <- data.frame(\n      AnimalID = paste0(\"Cow_\", sprintf(\"%02d\", i)),\n      Condition = condition,\n      t(generate_abundance())\n    )\n    colnames(sample_data)[3:ncol(sample_data)] <- bacteria_genera\n    data <- rbind(data, sample_data)\n  }\n}\n\n# Print the first few rows of the dataset\nhead(data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  AnimalID            Condition Staph_aureus E_coli Lactobacillus Bacillus\n1   Cow_01      Infected_Tissue         6.02  16.51          8.57    18.49\n2   Cow_01    Uninfected_Tissue        11.81   9.78         20.48     9.70\n3   Cow_01   Infected_Secretion         5.14   0.88          6.85    19.94\n4   Cow_01 Uninfected_Secretion        13.65  14.75         11.33    12.37\n5   Cow_02      Infected_Tissue        19.66  22.64          0.70    13.60\n6   Cow_02    Uninfected_Tissue         6.13  17.79         17.76    15.83\n  Clostridium Streptococcus Salmonella Other\n1       19.70          0.95      11.06 18.69\n2       14.51         12.26       2.20 19.26\n3       18.58         14.47      13.38 20.77\n4        6.02          3.06      20.05 18.78\n5       21.59          6.16       9.06  6.59\n6        6.54          5.96      10.00 20.00\n```\n\n\n:::\n\n```{.r .cell-code}\n# Load necessary libraries\ninstall.packages(\"vegan\")\ninstall.packages(\"ggplot2\")\nlibrary(vegan)\nlibrary(ggplot2)\nlibrary(dplyr)\n\n# Generate the data (based on the previous example)\nset.seed(123)  # For reproducibility\n\n# Parameters\nn_animals <- 80\nbacteria_genera <- c(\"Staph_aureus\", \"E_coli\", \"Lactobacillus\", \"Bacillus\", \"Clostridium\", \"Streptococcus\", \"Salmonella\", \"Other\")\n\n# Function to generate random microbiome data\ngenerate_abundance <- function() {\n  abundance <- runif(length(bacteria_genera), min = 0, max = 100)\n  return(round(100 * abundance / sum(abundance), 2))  # Normalize to sum to 100%\n}\n\n# Create the dataset\ndata <- data.frame()\n\nfor (i in 1:n_animals) {\n  for (condition in c(\"Infected_Tissue\", \"Uninfected_Tissue\", \"Infected_Secretion\", \"Uninfected_Secretion\")) {\n    sample_data <- data.frame(\n      AnimalID = paste0(\"Cow_\", sprintf(\"%02d\", i)),\n      Condition = condition,\n      t(generate_abundance())\n    )\n    colnames(sample_data)[3:ncol(sample_data)] <- bacteria_genera\n    data <- rbind(data, sample_data)\n  }\n}\n\n# Prepare the data for PCoA\n# Separate tissue and secretion samples\ndata_tissue <- data %>%\n  filter(grepl(\"Tissue\", Condition)) %>%\n  select(-AnimalID, -Condition)\n\ndata_secretion <- data %>%\n  filter(grepl(\"Secretion\", Condition)) %>%\n  select(-AnimalID, -Condition)\n\n# Combine data for PCoA\ncombined_data <- rbind(\n  data_tissue %>% mutate(SampleType = \"Tissue\"),\n  data_secretion %>% mutate(SampleType = \"Secretion\")\n)\n\n# Compute Bray-Curtis distance matrix\ndistance_matrix <- vegdist(combined_data[, -ncol(combined_data)], method = \"bray\")\n\n# Perform PCoA\npcoa_result <- cmdscale(distance_matrix, eig = TRUE, k = 2)\n\n# Create a data frame with the PCoA results\npcoa_df <- as.data.frame(pcoa_result$points)\ncolnames(pcoa_df) <- c('PC1', 'PC2')\npcoa_df$SampleType <- combined_data$SampleType\n\n# Plot the PCoA\nggplot(pcoa_df, aes(x = PC1, y = PC2, color = SampleType)) +\n  geom_point(size = 3) +\n  labs(title = \"PCoA of Microbiome Data: Tissue vs Secretion\",\n       x = \"Principal Coordinate 1\",\n       y = \"Principal Coordinate 2\") +\n  theme_minimal() +\n  scale_color_manual(values = c(\"Tissue\" = \"blue\", \"Secretion\" = \"green\"))\n```\n\n::: {.cell-output-display}\n![](BCB_520_Final_Project_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n\n## Spatial Data- Breastfeeding Rates\n\nI made a heat map for breastfeeding rates at 6 months based on the CDC Breastfeeding Report Card 2022.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nread.csv(\"C:/Users/betsy/OneDrive/Desktop/Master's Degree/BSBC Data.csv\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n            State BF.at.6.months..2022 mPINC..2022 BF.at.6.months.2020\n1         Alabama                 21.0          76                20.4\n2          Alaska                 30.9          82                35.3\n3         Arizona                 24.0          78                24.6\n4        Arkansas                 24.4          75                19.4\n5      California                 27.3          87                28.2\n6        Colorado                 32.1          85                34.1\n7     Connecticut                 26.3          87                25.7\n8        Delaware                 25.0          84                23.6\n9         Florida                 18.2          81                19.9\n10        Georgia                 18.7          75                22.1\n11         Hawaii                 27.7          75                30.6\n12          Idaho                 30.4          77                24.6\n13       Illinois                 28.3          82                23.9\n14        Indiana                 21.5          83                21.1\n15           Iowa                 27.0          75                24.8\n16         Kansas                 29.2          83                31.6\n17       Kentucky                 21.2          73                23.0\n18      Louisiana                 22.2          81                21.8\n19          Maine                 28.7          86                28.1\n20       Maryland                 29.2          83                29.4\n21  Massachusetts                 25.1          85                23.9\n22       Michigan                 36.5          78                25.8\n23      Minnesota                 36.5          81                38.7\n24    Mississippi                 15.6          83                18.1\n25       Missouri                 24.6          79                23.4\n26        Montana                 34.3          81                31.1\n27       Nebraska                 26.0          73                32.6\n28         Nevada                 22.3          72                21.7\n29  New Hampshire                 31.8          90                36.7\n30     New Jersey                 23.5          82                27.7\n31     New Mexico                 29.0          82                26.6\n32       New York                 23.4          83                25.8\n33 North Carolina                 22.1          84                23.3\n34   North Dakota                 27.4          77                29.1\n35           Ohio                 23.7          84                21.6\n36       Oklahoma                 23.2          79                23.7\n37         Oregon                 34.2          87                35.6\n38   Pennsylvania                 24.6          80                25.9\n39 South Carolina                 19.3          82                25.6\n40   South Dakota                 29.1          77                32.1\n41      Tennessee                 24.9          70                27.2\n42          Texas                 24.0          79                23.9\n43           Utah                 27.3          77                26.3\n44        Vermont                 36.2          85                36.8\n45       Virginia                 25.8          82                30.4\n46     Washington                 29.5          85                28.9\n47  West Virginia                 13.8          80                20.9\n48      Wisconsin                 31.3          80                28.1\n49        Wyoming                 27.2          75                31.8\n   mPINC.at.2020 BF.at.6.months.2018 mPINC.2018         Region  BF.2018\n1             78                20.6         78   Mid-Atlantic 24.43333\n2             83                42.1         83 MountainPlains 28.87500\n3             77                26.3         77        Midwest 27.68571\n4             69                20.4         69      Northeast 29.50000\n5             86                26.3         86      Southeast 21.52500\n6             85                22.4         85      Southwest 24.00000\n7             85                23.6         85        Western 30.42857\n8             83                23.6         83                      NA\n9             81                21.3         81                      NA\n10            73                22.1         73                      NA\n11            68                32.9         68                      NA\n12            75                28.4         75                      NA\n13            80                19.5         80                      NA\n14            78                31.7         78                      NA\n15            72                29.5         72                      NA\n16            79                26.1         79                      NA\n17            68                21.1         68                      NA\n18            75                20.2         75                      NA\n19            73                34.1         85                      NA\n20            79                26.2         79                      NA\n21            86                26.6         86                      NA\n22            77                23.9         77                      NA\n23            82                37.2         82                      NA\n24            73                13.0         73                      NA\n25            75                31.3         75                      NA\n26            86                35.7         86                      NA\n27            71                25.4         71                      NA\n28            77                20.8         77                      NA\n29            90                30.2         90                      NA\n30            80                24.4         80                      NA\n31            82                27.6         82                      NA\n32            82                21.4         82                      NA\n33            77                27.0         77                      NA\n34            73                29.1         73                      NA\n35            78                23.7         78                      NA\n36            75                21.6         75                      NA\n37            85                33.4         85                      NA\n38            78                25.6         78                      NA\n39            77                24.4         77                      NA\n40            73                32.2         73                      NA\n41            72                22.7         72                      NA\n42            77                24.1         77                      NA\n43            73                27.8         73                      NA\n44            82                38.0         82                      NA\n45            81                26.6         81                      NA\n46            86                29.1         85                      NA\n47            76                20.2         76                      NA\n48            80                28.3         80                      NA\n49            76                28.8         76                      NA\n    BF.2020  BF.2022\n1  26.31667 23.65000\n2  30.72500 28.73750\n3  26.28571 29.25714\n4  28.98333 28.58333\n5  22.45000 20.12500\n6  23.75714 24.87143\n7  29.27143 28.90000\n8        NA       NA\n9        NA       NA\n10       NA       NA\n11       NA       NA\n12       NA       NA\n13       NA       NA\n14       NA       NA\n15       NA       NA\n16       NA       NA\n17       NA       NA\n18       NA       NA\n19       NA       NA\n20       NA       NA\n21       NA       NA\n22       NA       NA\n23       NA       NA\n24       NA       NA\n25       NA       NA\n26       NA       NA\n27       NA       NA\n28       NA       NA\n29       NA       NA\n30       NA       NA\n31       NA       NA\n32       NA       NA\n33       NA       NA\n34       NA       NA\n35       NA       NA\n36       NA       NA\n37       NA       NA\n38       NA       NA\n39       NA       NA\n40       NA       NA\n41       NA       NA\n42       NA       NA\n43       NA       NA\n44       NA       NA\n45       NA       NA\n46       NA       NA\n47       NA       NA\n48       NA       NA\n49       NA       NA\n```\n\n\n:::\n\n```{.r .cell-code}\n# Load necessary libraries\nlibrary(ggplot2)\nlibrary(sf)\nlibrary(dplyr)\nlibrary(maps)\n\n# Example breastfeeding data\nbreastfeeding_data <- read.csv(\"C:/Users/betsy/OneDrive/Desktop/Master's Degree/BSBC Data.csv\")\n\n# Get US states map data\nus_states <- st_as_sf(map(\"state\", plot = FALSE, fill = TRUE))\n\n# Correct state names to match the map data (lowercase and no spaces)\nbreastfeeding_data$State <- tolower(breastfeeding_data$State)\n\n# Merge the breastfeeding data with the spatial data\nmerged_data <- us_states %>%\n  mutate(State = tolower(ID)) %>%\n  left_join(breastfeeding_data, by = c(\"State\" = \"State\"))\n\n# Plot the heat map\nggplot(merged_data) +\n  geom_sf(aes(fill = BF.at.6.months..2022)) +\n  scale_fill_viridis_c(option = \"plasma\", na.value = \"grey90\") +\n  labs(title = \"Breastfeeding Rates at 6 Months by State (2022)\",\n       fill = \"Rate (%)\") +\n  theme_minimal() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank())\n```\n\n::: {.cell-output-display}\n![](BCB_520_Final_Project_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n\n# Conclusions/Summary\n\nIf the mock data were actually a true representation of my data, I would conclude that there is a tissue microbiome, because we did find multiple genera of bacteria. The relative abundance of bacteria is different between the two tissue locations, with edge tissue having slightly higher abundance across all found genera. Whether it is statistically different is currently unknown because I did not run statistics. Considering mean relative abundance of bacteria in uninfected versus infected tissue, the graph shows that the uninfected tissue generally has slightly higher relative abundance across the board, with the exception of S.aureus, which one would expect when that is the infectious agent. Looking at the PCoA plot for tissue location and infection status, it seems there might be some clustering based on infection status, but it's not clear. When looking at the heat map for secretions, there doesn't seem to be a difference in the relative abundance between the days for any of the genera, but there is a distinct difference between the infected and uninfected secretions overall, with lactobacillus being the most abundant genera in the uninfected and s.aureus being the most abundant in the infected secretions. Comparing the mean relative abundance of bacteria of the tissue to the secretions based on infection status doesn't show us that they are related. For example, the Relative Abundance of bacillus in the infected tissue is not the same as the Relative Abundance of bacillus in the infected secretions.\n\nI am very interested to see what my actual data shows!\n",
    "supporting": [
      "BCB_520_Final_Project_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}